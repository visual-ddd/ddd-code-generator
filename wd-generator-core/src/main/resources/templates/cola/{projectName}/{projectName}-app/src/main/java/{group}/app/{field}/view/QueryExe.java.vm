#parse("templates/ClassFunction.vm")
#set($dtoClassName = ${QUERY_RETURN_INFO.type})
#set($doClassName = ${IMPORT_PACKAGE_MAP.get("mapper::${dtoClassName}")})
#set($doPackagePath = ${IMPORT_PACKAGE_MAP.get("${doClassName}")})
#set($aggregationClassName = ${IMPORT_PACKAGE_MAP.get("mapper::${doClassName}")})
#set($aggregationPackagePath = ${IMPORT_PACKAGE_MAP.get("${aggregationClassName}Mapper")})
package ${IMPORT_PACKAGE_MAP.get("${QUERY_CLASS_NAME}Exe")};

import java.util.List;
import javax.annotation.Resource;
import com.github.pagehelper.PageInfo;
import com.github.pagehelper.PageHelper;
import com.wakedata.common.core.dto.PageResultDTO;
import com.wakedata.common.core.dto.ResultDTO;
import org.springframework.stereotype.Component;
import ${IMPORT_PACKAGE_MAP.get(${QUERY_CLASS_NAME})}.${QUERY_CLASS_NAME};
import ${doPackagePath}.${doClassName};
import ${aggregationPackagePath}.${aggregationClassName}Mapper;
import ${IMPORT_PACKAGE_MAP.get(${dtoClassName})}.${dtoClassName};
import ${IMPORT_PACKAGE_MAP.get("${QUERY_RETURN_INFO.type}2DOConvert")}.${QUERY_RETURN_INFO.type}2DOConvert;

#comment("${QUERY_CLASS_DESCRIPTION}-查询器")
@Component
public class ${QUERY_CLASS_NAME}Exe {
    @Resource
    private ${aggregationClassName}Mapper ${aggregationClassName.toLowerCase()}Mapper;

    #if(${QUERY_PAGINATION})
    public PageResultDTO<${dtoClassName}> execute(${QUERY_CLASS_NAME} pageQuery) {

        PageHelper.startPage(pageQuery.getPageNo(),pageQuery.getPageSize());
##
        List<$doClassName> ${aggregationClassName.toLowerCase()}DoList = ${aggregationClassName.toLowerCase()}Mapper.${CASE_FORMAT_LOWER_CAMEL.convert(${QUERY_CLASS_NAME})}(pageQuery);
        PageInfo<$doClassName> pageInfo = new PageInfo<>(${aggregationClassName.toLowerCase()}DoList);
        List<${QUERY_RETURN_INFO.type}> ${CASE_FORMAT_LOWER_CAMEL.convert(${QUERY_RETURN_INFO.type})}List = ${QUERY_RETURN_INFO.type}2DOConvert.INSTANCE.doList2DtoList(pageInfo.getList());

        PageResultDTO<List<${QUERY_RETURN_INFO.type}>> pageResultDTO = new PageResultDTO<>();
        pageResultDTO.setData(${CASE_FORMAT_LOWER_CAMEL.convert(${QUERY_RETURN_INFO.type})}List);
        pageResultDTO.setPageNo(pageInfo.getPageNum());
        pageResultDTO.setPageSize(pageInfo.getSize());
        pageResultDTO.setTotalCount(pageInfo.getTotal());
        return pageResultDTO;
    }
    #end
    #if(!${QUERY_PAGINATION})
    public ResultDTO<${QUERY_RETURN_INFO.type}> execute(${QUERY_CLASS_NAME} query) {
        $doClassName ${aggregationClassName.toLowerCase()}DO = ${aggregationClassName.toLowerCase()}Mapper.${CASE_FORMAT_LOWER_CAMEL.convert(${QUERY_CLASS_NAME})}(query);
        ${QUERY_RETURN_INFO.type} ${CASE_FORMAT_LOWER_CAMEL.convert(${QUERY_RETURN_INFO.type})} = ${QUERY_RETURN_INFO.type}2DOConvert.INSTANCE.do2Dto(${aggregationClassName.toLowerCase()}DO);
        return ResultDTO.success(${CASE_FORMAT_LOWER_CAMEL.convert(${QUERY_RETURN_INFO.type})});
    }
    #end

}
